\subsubsection{Step 1. Forming the Integral Transformation of ESD $(\rho_{\AMAT}^{\infty}(\lambda))$}
\label{sxn:tanaka_step1}
We first establish \EQN~\ref{eqn:ZD_step1}, in Steps $1.1-1.4$.
This is done by changing variables under a Unitary transformation, $\mathbf{W}\rightarrow\mathbf{\check{W}}$,
evaluating the resulting functional determinant,
and then taking the continuum limit of the ESD
$\tilde{\rho}_{\AMAT}(\lambda)\rightarrow\rho^{\infty}_{\AMAT}(\lambda)$.

\paragraph{Step 1.1}
%\nred{We need to check all the equations, I might have flipped the transpose in the second term with the source matrix from right to left.}\michael{I think I fixed this, check.}
To do so, let us first assume that \Teacher correlation matrix $\mathbf{X}$ and the source matrix $\mathbf{D}$
are simultaneously diagonalizable  
(i.e., their commutator is zero: $[\mathbf{X}, \mathbf{D}]=0$).
\michael{@charles: where precisely is this assumption used?}
\charles{Its used in Step 1.3 }
In this case, we may write the generating function $\ZD$ in \EQN~\ref{eqn:ZD0} as
%
\begin{align}
\label{eqn:Z-diag}
\ZD &= \int d\mu(\mathbf{W}) \exp\frac{\beta}{2}
 \bigg( 
\Trace{\mathbf{W}^{\top}\mathbf{U}^{\top}\mathbf{\Lambda}\mathbf{U}\mathbf{W}} 
- \Trace{\mathbf{W}\mathbf{V}^{\top}\mathbf{\Delta}\mathbf{V}\mathbf{W}^{\top}} 
\bigg)  ,
\end{align}
\michaeladdressed{How do we get this?  Is this just \ref{eqn:dmuA}, rewritten?  But we have changed $d\mathbf{W}$ to $d\mathbf{X}$ and changed $\beta$ to $1/2$?  Or does this use the assumption $[\mathbf{X}, \mathbf{D}]=0$?}
where we have defined
%
\begin{equation}
\label{eqn:diag-A-D}
    \AMAT_{2}=\mathbf{U}^{\top}\mathbf{\Lambda}\mathbf{U},\;\;
    \mathbf{D}=\mathbf{V}^{\top}\mathbf{\Delta}\mathbf{V}  ,
\end{equation}
%
%%where $\mathbf{U}, \mathbf{V}$ are Unitary matrices
%%with $\mathbf{U}$ is $(N\times N)$ and $\mathbf{V}$ is $(M\times M)$.
where $\mathbf{U}$ ($N\times N$) and $\mathbf{V}$ ($M\times M$) are Unitary matrices.
%
%% 
%% %
%% Using the Orthogonality properties of $\mathbf{U}$ and $\mathbf{V}$,
%% %
%% \begin{equation}\label{eqn:UU}
%%     \mathbf{U}^{T}\mathbf{U}=\mathbf{I},\;\;
%%     \mathbf{V}^{T}\mathbf{V}=\mathbf{I},
%% \end{equation}
Since $\mathbf{U}^{\top}\mathbf{U}=\mathbf{I}$ and $\mathbf{V}^{\top}\mathbf{V}=\mathbf{I}$,
%
we can insert these identities into $\ZD$ in \ref{eqn:Z-diag}, giving
%
\begin{align}\label{eqn:Z0-diag}
\ZD &= \int d\mu(\mathbf{W}) \exp\frac{\beta}{2}\times  \\ \nonumber
&\bigg(\Trace{(\mathbf{V}^{\top}\mathbf{V})\mathbf{W}^{\top}\mathbf{U}^{\top}\mathbf{\Lambda}\mathbf{U}\mathbf{W}(\mathbf{V}^{\top}\mathbf{V})} 
-\Trace{(\mathbf{U}^{\top} \mathbf{U})\mathbf{W}\mathbf{V}^{\top} \mathbf{\Delta} \mathbf{V}\mathbf{W}^{\top}(\mathbf{U}^{\top} \mathbf{U})}\bigg)  .
\end{align}
We can identify the reduced weight matrix $\mathbf{\check{W}}$ as
\begin{equation}
   \label{eqn:Wcheck}
   \mathbf{\check{W}}=\mathbf{U}\mathbf{W}\mathbf{V}^{\top},\;\;
   \mathbf{\check{W}}^{\top}=\mathbf{V}\mathbf{W}^{\top}\mathbf{U}^{\top}  ,
\end{equation}
Rearranging parentheses, this gives 
\begin{align}
\ZD &= \int d\mu(\mathbf{W}) \exp\frac{\beta}{2}\times  \\ \nonumber
&\bigg(\Trace{\mathbf{V}^T(\mathbf{V}\mathbf{W}^T\mathbf{U}^T)\mathbf{\Lambda}(\mathbf{U}\mathbf{W}\mathbf{V}^T)\mathbf{V}}  
-\Trace{ \mathbf{U}^{\top}(\mathbf{U} \mathbf{W}\mathbf{V}^{\top})\mathbf{\Delta}(\mathbf{V}\mathbf{W}^{\top} \mathbf{U}^{\top})\mathbf{U} }\bigg)  .
\end{align}
We can now express $\ZD$ in terms of $\mathbf{\check{W}}$ as
\begin{align}
\label{eqn:hciz-W-red}
\ZD &= \int d\mu(\mathbf{W})\exp\frac{\beta}{2}
 \bigg(\Trace{\mathbf{V}^{\top}\mathbf{\check{W}}^{\top}\mathbf{\Lambda}\mathbf{\check{W}}\mathbf{V}} 
 -\Trace{\mathbf{U}^{\top}\mathbf{\check{W}}\mathbf{\Delta}\mathbf{\check{W}}^{\top}\mathbf{U}}\bigg)  .
\end{align}
Since the Trace operator $\Trace{\cdot}$ is invariant to Unitary (Orthogonal) transformations, we can
now remove the
$\mathbf{U}$ and $\mathbf{V}$ terms, giving the simplified expression
for our generating function $\ZD$ in terms of
the two diagonal matrices $\mathbf{\Lambda}, \mathbf{\Delta}$, 
the reduced weight matrix $\mathbf{\check{W}}$, and
the Jacobian $J(\mathbf{\check{W}})$ transformation for $d\mu(\mathbf{W})\rightarrow d\mu(\mathbf{\check{W}})$, as:
\begin{align}
\label{eqn:hciz-W-red2}
    \ZD & =\int d\mu(\mathbf{\check{W}})J(\mathbf{\check{W}})\exp\frac{\beta}{2}
 \bigg( \Trace{\mathbf{\check{W}}^{\top}\mathbf{\Lambda}\mathbf{\check{W}}} 
       -\Trace{\mathbf{\check{W}}\mathbf{\Delta} \mathbf{\check{W}}^{\top}} \bigg)  .
\end{align}


\paragraph{Step 1.2}

\michael{@charles: we are switching gears here, Im missing something in the flow. Where do we get the next equation from?}
\charles{@michael: standard stuff.  Should we provide a reference ?  Can you find it ?}
We can now evaluate the
integral using the standard relation for the functional determinant for infinite-dimensional Gaussian integrals~\cite{EngelAndVanDenBroeck}

\begin{equation}
\label{eqn:hciz-det}
    \ZD=\left(\dfrac{2\pi}{\beta}\right)^{NM/2}\det\left(\mathbf{\Delta}-\mathbf{\Lambda}\right)^{-1/2}
\end{equation}
where the Jacobian is unity for the Unitary transformation.
\michaeladdressed{Is this $\mathbf{W}$ or $d\mathbf{\check{W}}$?  Also, this is a weight matrix, not an orthogonal matrix correct?  Meaning that the Jacobian being one is due to the Trace-Log condition?}
\charles{@michael:
The transformation $\mathbf{W} \mapsto \check{\mathbf{W}} = \mathbf{U}\,\mathbf{W}\,\mathbf{V}^{\top}$ is orthogonal, so $J(\check{\mathbf{W}})=1$.}

\begin{equation}\label{eqn:Jacobian}
    J(\mathbf{\check{W}})=1  .
\end{equation}
since $\mathbf{W} \mapsto \check{\mathbf{W}}$  is an orthogonal transfomation.
We now use the standard Trace-Log-Determinant relation~\cite{EngelAndVanDenBroeck}
\begin{equation}\label{eqn:tr-ln-det}
    \Trace{\ln\mathbf{M}}=\ln\det\mathbf{M}  .
\end{equation}
Let us insert $(\exp\ln)$ on the R.H.S. of \ref{eqn:hciz-det}, to obtain
\begin{align}
\nonumber
\ZD
  &=\exp\ln\bigg[\left(\dfrac{2\pi}{\beta}\right)^{NM/2}\det\left(\mathbf{\Delta}-\mathbf{\Lambda}\right)^{-1/2}\bigg] \\ 
\nonumber
  & =\exp\bigg[\left(\dfrac{NM}{2}\right)\ln\dfrac{2\pi}{\beta}-\dfrac{1}{2}\Trace{\ln\left(\mathbf{\Delta}-\mathbf{\Lambda}
\right)}\bigg] \\ 
\label{eqn:hciz-exp-ln}
  & =\exp\bigg[\dfrac{NM}{2}\ln\dfrac{2\pi}{\beta}-\dfrac{1}{2}\ln\det\left(\mathbf{\Delta}-\mathbf{\Lambda}\right)\bigg]  .
\end{align}


\paragraph{Step 1.3}
We now want to express
%the Log-Determinant, $\ln\det\left(\mathbf{\Delta}-\mathbf{\Lambda}\right)$,
the generating function $\ZD$ 
in \ref{eqn:hciz-exp-ln}
in terms of an integral over the continuous limiting spectral density
$\rho_{\AMAT}(\lambda)$ of the correlation matrix $\AMAT_{2}$.  

First, we express the Determinant of the matrix $\mathbf{\Delta}-\mathbf{\Lambda}$ in terms of discrete eigenvalues:
\michaeladdressed{I think so; are you asking if we got the $M$ and $N$s correct?}
\charles{check minus sign}
\begin{equation}
\label{eqn:det-discrete}
    \det\left(\mathbf{\Delta}-\mathbf{\Lambda}\right)^{-1/2}=\prod_{\mu=1}^{M}\prod_{i=1}^{N}\left(\DeltaMu-\lambda_{i}\right)^{-1/2}  .
\end{equation}
%
This gives the Log-Determinant in terms of the $M$ (non-zero)
eigenvalues of $\mathbf{D}$ and $\AMAT_{2}$, as
\begin{equation}
\label{eqn:ln-det-discrete}
    \ln\det\left(\mathbf{\Delta}-\mathbf{\Lambda}\right)^{-1/2}=-\dfrac{1}{2}\sum_{\mu=1}^{M}\sum_{i=1}^{N}\ln\left(\DeltaMu-\lambda_{i}\right)  .
\end{equation}
%
We can express %Define 
the ESD, $\tilde\rho_{\AMAT}(\lambda)$, of the 
Student Correlation 
matrix
$\AMAT_N$ in terms of the Dirac delta-function, $\delta(x)$, as
\begin{equation}
\label{eqn:rho-emp}
    \tilde\rho_{\AMAT}(\lambda)=\frac{1}{N}\sum_{i=1}^{N}\delta(\lambda-\lambda_{i})  .
\end{equation}
Using this, the \ExpectedValue of the Log-Determinant 
in \ref{eqn:ln-det-discrete}
can be expressed in terms of the ESD of
$\AMAT_N$ as
\begin{align}
\nonumber
\Expected[\AMAT_N]{\ln\det\left(\mathbf{\Delta}-\mathbf{\Lambda}\right)^{-1/2}}
   & = -\dfrac{1}{2}\sum_{\mu=1}^{M}\sum_{i=1}^{N}\int
       d\lambda\ln(\DeltaMu-\lambda)\delta(\lambda-\lambda_{i}) \\ 
\nonumber
   & = -\dfrac{1}{2}\sum_{\mu=1}^{M}\int
       d\lambda\ln(\DeltaMu-\lambda)\sum_{i=1}^{N}\delta(\lambda-\lambda_{i}) \\ 
\label{eqn:ln-det-rho}
   & = -\dfrac{1}{2}\sum_{\mu=1}^{M}\int
       d\lambda\ln(\DeltaMu-\lambda)
       N\tilde\rho_{\AMAT}(\lambda)  .
\end{align}

Let us insert this back into our
expression for the generating function,
\ref{eqn:hciz-exp-ln},   %% ~\ref{eqn:hciz-exp-ln3}, 
giving
$\EZDATWO$ in terms of the ESD $\tilde{\rho}_{\AMAT}$ as
\begin{equation}
\label{eqn:Z-rho}
    \EZDATWO=\exp\bigg\{\dfrac{N}{2}\big[M\ln\dfrac{2\pi}{\beta}-\sum_{\mu=1}^{M}\int
        d\lambda\ln(\DeltaMu-\lambda)\tilde{\rho}_{\AMAT}(\lambda)\big]\bigg\}  .
\end{equation}
\michael{BTW, I get a $1/\beta$ on the second term, when I derive it, so I think we missed a $\beta$ in the numerator somewhere.}
\charles{Yeah we gotta check all this very carefully}

We can now replace
the sum over the $N$ eigenvalues $\lambda_{i}$ with an integral over the limiting
ESD, $\rho(\lambda)$, to obtain
\begin{equation}
\label{eqn:rho-}
\rho^{\infty}_{\AMAT}(\lambda)=    \lim_{N\rightarrow\infty}\tilde\rho_{\AMAT}(\lambda)  .
\end{equation}
Observe that this effectively means that we are taking a large-$N$ limit, $N\gg 1$.
%
This lets us write the \ExpectedValue of the generating function $\ZD$
in \ref{eqn:Z-rho}
as
\begin{equation}
\label{eqn:Z-rho-2}
    \lim_{N\gg 1}\EZDATWO=\exp\bigg\{\dfrac{N}{2}\big[M\ln\dfrac{2\pi}{\beta}-
    \sum_{\mu=1}^{M}\int
        d\lambda\ln(\DeltaMu-\lambda)\rho^{\infty}_{\AMAT}(\lambda)\big]\bigg\}
\end{equation}
\michael{We just added an expectation. Is that correct? I think we missed something.}
\charles{No, this is correct.  But I obviously did not explain it well.  Will review}

\paragraph{Step 1.4}

Using the Self-Averaging Property,
\begin{equation}
   \ln \EZDATWO \simeq \Expected[\mathbf{A}_M]{\ln \ZD} ,
\end{equation}
It follows from \EQN~\ref{eqn:Z-rho-2}
that
\begin{equation}
   \lim_{N\gg 1} \ln \EZDATWO
   \simeq \dfrac{N M}{2}\ln\dfrac{2\pi}{\beta}
         -\dfrac{N}{2}\sum_{\mu=1}^{M}\int d\lambda\ln(\DeltaMu-\lambda)\rho^{\infty}_{\AMAT}(\lambda)  .
\end{equation}
%
The $N$-dependence now cancels out,
\michael{How? / Why? / Or because of what we do in the next step?}
\charles{@michael We took the log and the exp cancels out}
and we are left an approximate expression due to the remaining dependence of the continuum limiting density
$\rho^{\infty}_{\AMAT}(\lambda)$ (for $\AMAT=\mathbf{A}_{2}$)
%
\begin{equation}
\label{eqn:ln-Z-Nlim2}
    \lim_{N \gg 1}\dfrac{2}{N}\ln \EZDATWO
    = M\ln\dfrac{2\pi}{\beta}-\sum_{\mu=1}^{M}\int d\lambda\ln(\DeltaMu-\lambda)\rho^{\infty}_{\AMAT}(\lambda)  .
\end{equation}
\michael{We still have a factor of 2 issue}
\charles{Where ?  }
This completes the derivation of \EQN~\ref{eqn:ZD_step1}; 
we have an expression for the expected value of $\ZD$,
evaluated in the large-$N$ (continuum) limit.

